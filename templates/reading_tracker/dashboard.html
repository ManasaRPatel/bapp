{% extends 'base.html' %}

{% block title %}Dashboard - Book Reading Habit Analyzer{% endblock %}

{% block extra_css %}
<style>
body {
  background-color: #f7f9fc;
  font-family: 'Segoe UI', sans-serif;
  min-width: 1024px;
}

.dashboard-container {
  width: 1200px;
  margin: 0 auto;
  padding: 40px 20px;
}

/* Header */
.dashboard-header {
  text-align: center;
  margin-bottom: 40px;
}

.dashboard-header h1 {
  font-size: 32px;
  font-weight: 700;
  color: #2d3748;
  margin: 0;
}

/* Stats cards */
.stats-row {
  display: flex;
  justify-content: center;
  gap: 24px;
  margin-bottom: 40px;
}

.stat-box {
  background: #ffffff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  padding: 24px;
  text-align: center;
  width: 280px;
}

.stat-box h5 {
  font-size: 16px;
  color: #4a5568;
  margin-bottom: 8px;
  font-weight: 600;
}

.stat-box .stat-value {
  font-size: 36px;
  font-weight: 700;
  color: #2b6cb0;
  line-height: 1.2;
}

/* Charts section in single box */
.chart-section {
  background: #ffffff;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
  padding: 32px;
  margin-bottom: 40px;
}

.chart-section h2 {
  font-size: 20px;
  font-weight: 600;
  color: #2d3748;
  margin-bottom: 24px;
  text-align: center;
}

.charts-row {
  display: flex;
  gap: 24px;
  justify-content: center;
  flex-wrap: wrap;
}

.chart-box {
  background: #f9fafb;
  border-radius: 12px;
  flex: 1;
  min-width: 500px;
  max-width: 600px;
  padding: 24px;
  box-shadow: inset 0 0 0 1px #e2e8f0;
}

.chart-box h4 {
  font-size: 18px;
  font-weight: 600;
  color: #2d3748;
  margin-bottom: 16px;
  text-align: center;
}

.chart-container {
  height: 300px;
  position: relative;
}

/* Info cards */
.info-row {
  display: flex;
  gap: 24px;
  flex-wrap: wrap;
}

.info-box {
  background: #ffffff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  padding: 24px;
  flex: 1;
  min-width: 400px;
}

.info-box.reading {
  border-left: 6px solid #4299e1;
}

.info-box.goal {
  border-left: 6px solid #48bb78;
}

.info-box h4 {
  font-size: 18px;
  font-weight: 600;
  color: #2d3748;
  margin-bottom: 1rem;
}

.info-box p {
  font-size: 16px;
  color: #4a5568;
  margin: 0.5rem 0;
}

.info-box strong {
  color: #2d3748;
  font-weight: 600;
}
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>ðŸ“š Reading Dashboard</h1>
  </div>

  <div class="stats-row">
    <div class="stat-box">
      <h5>Books Completed Reading</h5>
      <div class="stat-value">{{ books_completed }}</div>
    </div>
    <div class="stat-box">
      <h5>Total Books Read</h5>
      <div class="stat-value">{{ total_books }}</div>
    </div>
    <div class="stat-box">
      <h5>Total Pages Read</h5>
      <div class="stat-value">{{ total_pages }}</div>
    </div>
  </div>

  <!-- CHARTS IN ONE CONTAINER -->
  <div class="chart-section">
    <h2>ðŸ“Š Reading Overview</h2>
    <div class="charts-row">
      <div class="chart-box">
        <h4>Genre Distribution</h4>
        <div class="chart-container">
          <canvas id="genreChart"></canvas>
        </div>
      </div>
      <div class="chart-box">
        <h4>Book Status</h4>
        <div class="chart-container">
          <canvas id="statusChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="info-row">
    {% if current_book %}
    <div class="info-box reading">
      <h4>ðŸ“– Currently Reading</h4>
      <p><strong>Title:</strong> {{ current_book.title }}</p>
      <p><strong>Author:</strong> {{ current_book.author }}</p>
    </div>
    {% endif %}

    {% if active_goal %}
    <div class="info-box goal">
      <h4>ðŸŽ¯ Reading Goal</h4>
      <p>Target: <strong>{{ active_goal.target_pages }}</strong> pages by <strong>{{ active_goal.end_date|date:"M d, Y" }}</strong></p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  fetch('/api/genre-distribution/')
    .then(res => res.json())
    .then(data => {
      const ctx = document.getElementById('genreChart').getContext('2d');
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: data.labels,
          datasets: [{
            data: data.data,
            backgroundColor: data.colors,
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
              labels: {
                font: { size: 14 }
              }
            }
          }
        }
      });
    });

  fetch('/api/book-status/')
    .then(res => res.json())
    .then(data => {
      const ctx = document.getElementById('statusChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: data.labels,
          datasets: [{
            data: data.counts,
            backgroundColor: data.colors,
            borderRadius: 6,
            maxBarThickness: 60
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { stepSize: 1, font: { size: 14 } },
              grid: { display: false }
            },
            x: {
              ticks: { font: { size: 14 } },
              grid: { display: false }
            }
          }
        }
      });
    });
});
</script>
{% endblock %}
